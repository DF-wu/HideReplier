<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hide Replyer</title>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/11.0.0/markdown-it.min.js"></script>


</head>
<body>
<h1 id="title">我只會這個</h1>

<div >
</div>

<table border="1" cellspacing="3" cellpadding="5" id="messageForm">
    <tr>
        <td>機器人名稱：</td>
        <td><input id="input_botname" type="text" size="10"></td>
        <td rowspan = 3>
            說明 還沒寫
        </td>
    </tr>
    <tr>
        <td>內容:</td>
        <td><textarea id="input_content" col="10" row="10" value=""></textarea>
        </td>
    </tr>
    <tr>
        <td>
            顏色(裝飾)
        </td>
        <td>
            <div><input id="color" type="color"></div>
        </td>      
    </tr>
    <tr>
        <td>
            圖片連結（可選）
        </td>
        <td >
            <input id="img" value="" type="text">       
        </td>
        <td>
            <input id="isImgur" type="checkbox" > 貼imgur的bbcode
        </td>
        
    </tr>  
</table>
<input id="summitPost" type="button" value="點我送出" onclick="postData()">
<br>
<div id="postData">回傳資訊</div>




<script>
    var md = window.markdownit();
    var result = md.render('## 匿名回覆機器人 \n ##### 訊息支援部分markdown語法 你敢信？\n---');
    document.getElementById("title").innerHTML= result;

    window.addEventListener('load', function() {
        console.log("被JS炸到體無完膚................................");
    })
    
    function postData() {
        // url = "http://localhost:8080/HideBot/discord";  //local
        // url = "https://hidedbot.herokuapp.com/HideBot/discord"  // herokuapp
        let url = window.location.origin + "/HideBot/discord" ;

        content = document.getElementById("input_content").value;
        botname = document.getElementById("input_botname").value;
        imgUrl = document.getElementById("img").value;
        color = document.getElementById("color").value;
        
        isImgur = document.getElementById("isImgur");
        if(isImgur.checked) {
            imgUrl = covertlink2Static(imgUrl);
        }
        

        json = {
        username:botname,
        content: content, 
        color: color,
        imgUrl: imgUrl
        }
        
        //print json to debug 
        console.log(JSON.stringify(json) + "\n");

        // Default options are marked with *
        return fetch(url, {
          body: JSON.stringify(json), // must match 'Content-Type' header
          cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
          credentials: 'same-origin', // include, same-origin, *omit
          headers: {
            'user-agent': 'Mozilla/4.0 DF QQ ',
            'content-type': 'application/json'
          },
          method: 'POST', // *GET, POST, PUT, DELETE, etc.
          mode: 'cors', // no-cors, cors, *same-origin
          redirect: 'follow', // manual, *follow, error
          referrer: 'no-referrer', // *client, no-referrer
        })
        .then(response => response.json().then(
            res => {
                console.log("Server Response:\n");
                console.log(res);
            }
        ));
    }  

    function covertlink2Static(url) {
        //[img]https://i.imgur.com/YI9xyAN.jpg[/img]
        return (url.replace("[img]","").replace("[/img]","") );
    }

    function testPost()
    {
        isImgur = document.getElementById("isImgur");
        console.log(isImgur.checked);
        return isImgur.checked;
    
    }


    function time() {
        new Date().getTime();
    }

    
    
</script>
</body>


</html>